# Subtitles and Audio Tracks

## Subtitles

Letterbox web is based on [video.js](https://docs.videojs.com/), which means all features offered by video.js regarding subtitles, better known as Text Tracks, are fully supported by default. It includes a cross-browser compatibility and the ability to handle **external** and **internal** Text Tracks

However, there are some specific uses cases when dealing with external and internal text tracks to keep in mind, some related to video.js itself, others to how the SRG SSR provides subtitles information. 

- Subtitles from SRG SSR has to follow some rules to be displayed correctly :
    1. Letterbox web **does not support TTML** text tracks as they are not natively supported by browsers. Also there is no official plugin provided by video.js to supported them. The only plugin available only provides support when TTML text tracks are provided as an external resource.

    2. Letterbox web checks if the MediaComposition contains **subtitleList** and **subtitleInformationList**
        - If both are empty that means only **internal** text tracks will be displayed to the user as they are automatically loaded by the player.
        - If **subtitleInformationList** is missing from the MediaComposition and **subtitleList** is available but the media contains **internal** text tracks that are also available internaly. It will result on a duplication client side.
        - If **subtitleList** and **subtitleInformationList** a merge between both will be operated, removing the **external** text tracks already available **internaly**

- Video.js tells the following about [text tracks](https://docs.videojs.com/tutorial-text-tracks.html) :
    > Video.js refers to so-called "remote" text tracks. This is a convenient term for tracks that have an associated `<track>` element rather than those that do not.

    > Either can be created programmatically, **but only remote text tracks can be removed from a player**. For that reason, we recommend only using remote text tracks.
- There is no refresh of the interface proposed by iOS in fullscreen when a text track change occurs from the HTML player.

Finally, the method responsible to filter **external** and **internal** text tracks only returns the external resources to be added to the player strictly following the rules explained above. 

__Examples:__

1. [Tagesschau vom 01.11.2019](https://srgssr.github.io/srgletterbox-web/?urn=urn:srf:video:205617f8-2009-4183-8605-672ffe71b56c) contains subtitleList and subtitleInformationList:
    - ```json
        ...
        "subtitleList" : [ {
            "locale" : "de",
            "language" : "Deutsch",
            "source" : "EXTERNAL",
            "type" : "SDH",
            "url" : "https://ws.srf.ch/subtitles/urn:srf:ais:video:205617f8-2009-4183-8605-672ffe71b56c/subtitle.vtt",
            "format" : "VTT"
            }, {
            "locale" : "de",
            "language" : "Deutsch",
            "source" : "EXTERNAL",
            "type" : "SDH",
            "url" : "https://ws.srf.ch/subtitles/urn:srf:ais:video:205617f8-2009-4183-8605-672ffe71b56c/subtitle.ttml",
            "format" : "TTML"
        } ],
        ...
       ```
    - ```json
       ...
       "subtitleInformationList" : [ {
            "locale" : "de",
            "language" : "Deutsch",
            "source" : "HLS",
            "type" : "SDH"
       } ],
       ...
       ```
    - __Result__: Deutsch VTT is filtered as subtitleInformationList already provide Deutsch. Deutsch TTML is filtered as they are not supported. Thus, only internal subtitles are displayed to the user.

2. [Wer wohnt wo?](https://srgssr.github.io/srgletterbox-web/?urn=urn:srf:video:41f4b510-4d18-413f-aed2-c1e3909ed43b) contains subtitleInformationList but no subtitleList
    - ```json
       ...
       "subtitleInformationList" : [ {
            "locale" : "de",
            "language" : "Deutsch",
            "source" : "HLS",
            "type" : "SDH"
       } ],
       ...
       ```
    - __Result__: Only internal subtitles are displayed to the user.

3. [19h30](https://srgssr.github.io/srgletterbox-web/?urn=urn:rts:video:11005133) contains subtitleList but no subtitleInformationList, however internal subtitles are available.
    - ```json
       ...
       "subtitleList" : [ {
         "locale" : "fr",
         "language" : "Français",
         "source" : "EXTERNAL",
         "type" : "SDH",
         "url" : "https://www.rts.ch/x/sub/journ-19h30/2020/a12a976ca60e3a4669fc077ee96f6d36/journ-19h30_20200111_full_fra.vtt",
         "format" : "VTT"
       } ],
       ...
       ```
    - __Result__: Français will be displayed twice to the user.

4. [Rodents sniff out landmines](https://srgssr.github.io/srgletterbox-web/?urn=urn:swi:video:44927366) contains subtitleList but no subtitleInformationList, no internal subtitles are available.
    - ```json
       ...
       "subtitleList" : [ {
         "locale" : "ar",
         "language" : "عربي",
         "source" : "EXTERNAL",
         "type" : "SDH",
         "url" : "https://media.swissinfo.ch/videos/2019/05/06/190429_Ratdeminer_EN_3_44927366_9.ar-44943968.vtt",
         "format" : "VTT"
      }, {
         "locale" : "en",
         "language" : "English",
         "source" : "EXTERNAL",
         "type" : "SDH",
         "url" : "https://media.swissinfo.ch/videos/2019/04/29/190429_Ratdeminer_EN_3-44927366.vtt",
         "format" : "VTT"
      }, {
         "locale" : "ja",
         "language" : "日本語",
         "source" : "EXTERNAL",
         "type" : "SDH",
         "url" : "https://media.swissinfo.ch/videos/2019/05/07/landmine_mouse_video-44946738.vtt",
         "format" : "VTT"
      }, {
         "locale" : "ru",
         "language" : "Pусский",
         "source" : "EXTERNAL",
         "type" : "SDH",
         "url" : "https://media.swissinfo.ch/videos/2019/05/02/190429_Ratdeminer2_44927366_5_44936048_1-44936048.vtt",
         "format" : "VTT"
      } ]
       ...
       ```
    - __Result__: عربي, English, 日本語, Pусский, will be displayed to the user.

4. Theorical use case that contains subtitleList and subtitleInformationList.
    - ```json
       ...
       "subtitleList" : [ {
         "locale" : "ar",
         "language" : "عربي",
         "source" : "EXTERNAL",
         "type" : "SDH",
         "url" : "https://media.swissinfo.ch/videos/2019/05/06/190429_Ratdeminer_EN_3_44927366_9.ar-44943968.vtt",
         "format" : "VTT"
      }, {
         "locale" : "en",
         "language" : "English",
         "source" : "EXTERNAL",
         "type" : "SDH",
         "url" : "https://media.swissinfo.ch/videos/2019/04/29/190429_Ratdeminer_EN_3-44927366.vtt",
         "format" : "VTT"
      }, {
         "locale" : "ja",
         "language" : "日本語",
         "source" : "EXTERNAL",
         "type" : "SDH",
         "url" : "https://media.swissinfo.ch/videos/2019/05/07/landmine_mouse_video-44946738.vtt",
         "format" : "VTT"
      }, {
         "locale" : "ru",
         "language" : "Pусский",
         "source" : "EXTERNAL",
         "type" : "SDH",
         "url" : "https://media.swissinfo.ch/videos/2019/05/02/190429_Ratdeminer2_44927366_5_44936048_1-44936048.vtt",
         "format" : "VTT"
      } ]
       ...
       ```
    - ```json
       ...
       "subtitleInformationList" : [ {
            "locale" : "de",
            "language" : "Deutsch",
            "source" : "HLS",
            "type" : "SDH"
       }, {
            "locale" : "en",
            "language" : "English",
            "source" : "HLS",
            "type" : "SDH",
      }, {
            "locale" : "ja",
            "language" : "日本語",
            "source" : "HLS",
            "type" : "SDH",
      } ],
       ...
    - __Result__: English and 日本語 are filtered as subtitleInformationList already provide both. Deutsch, English, 日本語 as internal subtitles, and عربي and Pусский as external subtitles will be displayed to the user.

## Colored Subtitles

Letterbox web by rewriting the __[TextTrackDisplay](https://github.com/videojs/video.js/blob/main/src/js/tracks/text-track-display.js)__ component from __video.js__ is able to support the __SRG SSR__ colored subtitles format. This format differs from the standard defined by the __W3C__.

__Examples:__

1. Colored subtitles defined by the __SRG SSR__ format.
    - ```html
      ...
      8
      00:00:39.612 --> 00:00:42.890
      <font color="#008000">Für mich ist es</font>
      <font color="#008000">eine traditionelle Sache.</font>

      9
      00:00:43.532 --> 00:00:46.130
      <font color="#ffff00">Als Frau ist es auch ein Traum.</font>

      10
      00:00:46.772 --> 00:00:48.569
      <font color="#008000">Weil wir uns lieben.</font>
      <font color="#ffff00">- Ja.</font>
      ...
      ```
2. Colored subtitles defined by the __[W3C](https://www.w3.org/TR/webvtt1/#default-text-background)__ format.
    - ```html
      02:00.000 --> 02:05.000
      <c.yellow.bg_blue>This is yellow text on a blue background</c>

      04:00.000 --> 04:05.000
      <c.yellow.bg_blue.magenta.bg_black>This is magenta text on a black background</c>
      ```

__SRG SSR standard known incompatibilities__, Safari, but more generally iOS and iPadOS are not able to reproduce colored subtitles. This is due to the fact that Apple products play HLS media without going through the HTML5 player layer. That means that the subtitle view is directly provided by the Apple HLS player and therefore the HTML contained in the subtitles is not interpreted.

__W3C standard know incompatibilites__, [Firefox](https://bugzilla.mozilla.org/show_bug.cgi?id=865395) has had an open issue for 8 years regarding the full compatibility of WebVTT. This means that if the SRG SSR decides to comply with the W3C standard, the color in the subtitles will be lost. Finally, the subtitle custom component will have to be rollback.

---

## Audio Tracks

_feature description is comming_, [videojs audio tracks](https://docs.videojs.com/tutorial-audio-tracks.html)

