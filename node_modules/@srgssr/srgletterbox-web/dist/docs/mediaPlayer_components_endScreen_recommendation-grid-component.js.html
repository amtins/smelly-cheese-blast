<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: mediaPlayer/components/endScreen/recommendation-grid-component.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: mediaPlayer/components/endScreen/recommendation-grid-component.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import videojs from 'video.js';
import EndScreenFeature from './end-screen-feature.js';
import Item from '../item-component.js';
import * as VideojsEvents from '../../../utils/VideojsEvents.js';
import * as SRGEvents from '../../../utils/SRGEvents.js';

/**
 * Maximum items
 * @type {number}
 */
const MAX_ITEMS = 18;
/**
 * Maximum row
 * @type {number}
 */
const MAX_ROWS = 6;
/**
 * Minimum image height
 * @type {number}
 */
const MIN_HEIGHT = 140;
/**
 * Minimum image width
 * @type {number}
 */
const MIN_WIDTH = 240;

/**
 *
 * @ignore
 */
class RecommendationGrid extends EndScreenFeature {
  constructor(player, options = {}) {
    super(player, options);
    this.recommendationId = null;
    this.on(player, VideojsEvents.PLAYER_RESIZE, this.gridTemplate.bind(this));
  }

  /**
   * Shows and build the recommendation grid
   *
   * @param {Number} options - mediaList and recommendationId
   *
   * @returns {undefined}
   */
  mount({ mediaList, recommendationId }) {
    this.recommendationId = recommendationId;
    mediaList.forEach((itemInfo) => {
      const item = new Item(this.player(), {
        itemInfo,
        recommendationId,
      });
      this.addChild(item);
    });
    this.gridTemplate();
  }

  /**
   * Hides and remove all recommendation items
   *
   * @returns {undefined}
   */
  unmount() {
    super.unmount();
    this.removeChildren();
  }

  /**
   * Get the number of items to show
   *
   * @param {Number} gridSize - Grid size
   * @param {Number} maxItemsPerRow - Maximum items per row
   *
   * @returns {Number}
   */
  static itemsToShow(gridSize, maxItemsPerRow) {
    if (gridSize > MAX_ITEMS) {
      return MAX_ITEMS - (MAX_ITEMS % maxItemsPerRow) - 1;
    }

    return gridSize - (gridSize % maxItemsPerRow) - 1;
  }

  /**
   * Show and adapt the grid template depending the number of items.
   * - If there is no items to show the grid is hidden.
   * - Show/hide the items depending on the maximum items to show.
   * @returns {undefined}
   */
  gridTemplate() {
    const paddingBottom = parseInt(
      videojs.computedStyle(this.el(), 'paddingBottom'),
      10,
    );
    // As the width and height are fluid a minimum value has been defined
    const itemsPerRow = (this.width() / MIN_WIDTH) | 0;
    const itemsPerCol = ((this.height() - paddingBottom) / MIN_HEIGHT) | 0;
    // Fix the maximum items per row
    const maxItemsPerRow = itemsPerRow > MAX_ROWS ? MAX_ROWS : itemsPerRow;
    const grid = itemsPerRow * itemsPerCol;
    // Avoid empty spaces in the matrix
    this.itemCount = RecommendationGrid.itemsToShow(grid, maxItemsPerRow);

    this.el().style.gridTemplateColumns = '1fr '.repeat(maxItemsPerRow).trim();

    if (!this.itemCount) {
      this.hide();
    } else {
      this.show();
    }

    this.children().forEach((item, i) => {
      if (i &lt;= this.itemCount) {
        item.show();
      } else {
        item.hide();
      }
    });

    this.triggerRecommendationDisplayed({
      recommendationId: this.recommendationId,
    });
  }

  displayedItems() {
    return this.children().filter(item => !item.hasClass('vjs-hidden'));
  }

  /**
   * Empty the endScreen element and remove the children.
   * @returns {undefined}
   */
  removeChildren() {
    videojs.dom.emptyEl(this.el());
    // remove all children at once
    this.children().length = 0;
  }

  /**
   * @event srgssr/recommendationDisplayed
   */
  triggerRecommendationDisplayed() {
    this.player().trigger(SRGEvents.RECOMMENDATION_DISPLAYED);
  }

  /**
   * Overrided methods
   */

  buildCSSClass() {
    return `${super.buildCSSClass()} srgssr-recommendation-grid`;
  }

  createEl() {
    const className = this.buildCSSClass();
    const el = videojs.dom.createEl('div', {
      className,
    });
    return el;
  }
}

videojs.registerComponent('RecommendationGrid', RecommendationGrid);
export default RecommendationGrid;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="SRGLetterbox.html">SRGLetterbox</a></li><li><a href="SRGLetterbox.MediaComposition.html">MediaComposition</a></li><li><a href="SRGUserStorage.html">SRGUserStorage</a></li></ul><h3>Events</h3><ul><li><a href="global.html#event:ADD_TRACK">ADD_TRACK</a></li><li><a href="global.html#event:ANIMATION_END">ANIMATION_END</a></li><li><a href="global.html#event:BEFOREUNLOAD">BEFOREUNLOAD</a></li><li><a href="global.html#event:CHANGE">CHANGE</a></li><li><a href="global.html#event:CLICK">CLICK</a></li><li><a href="global.html#event:KEY_DOWN">KEY_DOWN</a></li><li><a href="global.html#event:MOUSE_ENTER">MOUSE_ENTER</a></li><li><a href="global.html#event:srgssr/recommendationDisplayed">srgssr/recommendationDisplayed</a></li><li><a href="global.html#event:srgssr/recommendationHit">srgssr/recommendationHit</a></li><li><a href="global.html#event:WEBKIT_CURRENT_PLAYBACK_TARGET_IS_WIRELESS_CHANGED">WEBKIT_CURRENT_PLAYBACK_TARGET_IS_WIRELESS_CHANGED</a></li><li><a href="global.html#event:WEBKIT_PLAYBACK_TARGET_AVAILABILITY_CHANGED">WEBKIT_PLAYBACK_TARGET_AVAILABILITY_CHANGED</a></li><li><a href="SRGLetterbox.html#event:events">events</a></li><li><a href="SRGLetterbox.html#event:playerEvents">playerEvents</a></li><li><a href="SRGLetterbox.html#event:srgEvents">srgEvents</a></li><li><a href="SRGLetterbox.html#event:videojsEvents">videojsEvents</a></li></ul><h3>Global</h3><ul><li><a href="global.html#ABORT">ABORT</a></li><li><a href="global.html#ALMOST_STARTING">ALMOST_STARTING</a></li><li><a href="global.html#containQualities">containQualities</a></li><li><a href="global.html#DISPOSE">DISPOSE</a></li><li><a href="global.html#filterMainResourcesByQuality">filterMainResourcesByQuality</a></li><li><a href="global.html#findChapterByUrn">findChapterByUrn</a></li><li><a href="global.html#findDrmListByResource">findDrmListByResource</a></li><li><a href="global.html#findMainSegment">findMainSegment</a></li><li><a href="global.html#findResourceListByUrn">findResourceListByUrn</a></li><li><a href="global.html#getChapters">getChapters</a></li><li><a href="global.html#getFilteredExternalSubtitles">getFilteredExternalSubtitles</a></li><li><a href="global.html#getMainBlockReason">getMainBlockReason</a></li><li><a href="global.html#getMainChapter">getMainChapter</a></li><li><a href="global.html#getMainChapterImageUrl">getMainChapterImageUrl</a></li><li><a href="global.html#getMainResources">getMainResources</a></li><li><a href="global.html#getMainSegments">getMainSegments</a></li><li><a href="global.html#getMainValidFromDate">getMainValidFromDate</a></li><li><a href="global.html#getMergedAnalyticsData">getMergedAnalyticsData</a></li><li><a href="global.html#getMergedAnalyticsMetadata">getMergedAnalyticsMetadata</a></li><li><a href="global.html#getResourceList">getResourceList</a></li><li><a href="global.html#getSubdivisions">getSubdivisions</a></li><li><a href="global.html#isSourceHD">isSourceHD</a></li><li><a href="global.html#MAX_ITEMS">MAX_ITEMS</a></li><li><a href="global.html#MAX_ROWS">MAX_ROWS</a></li><li><a href="global.html#MIN_HEIGHT">MIN_HEIGHT</a></li><li><a href="global.html#MIN_WIDTH">MIN_WIDTH</a></li><li><a href="global.html#orderMainResourcesByQuality">orderMainResourcesByQuality</a></li><li><a href="global.html#orderMainResourcesByStreamType">orderMainResourcesByStreamType</a></li><li><a href="global.html#PERCENTAGE_MEDIA_CONSUMED">PERCENTAGE_MEDIA_CONSUMED</a></li><li><a href="global.html#PERIOD">PERIOD</a></li><li><a href="global.html#prefix">prefix</a></li><li><a href="global.html#SOON_VALID_PERIOD">SOON_VALID_PERIOD</a></li><li><a href="global.html#TOLERANCE">TOLERANCE</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Fri Feb 12 2021 09:53:42 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
