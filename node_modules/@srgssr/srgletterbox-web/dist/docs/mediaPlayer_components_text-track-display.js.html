<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: mediaPlayer/components/text-track-display.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: mediaPlayer/components/text-track-display.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import videojs from 'video.js';
import * as Events from '../../utils/Events.js';

import SupportedDevices from '../../utils/SupportedDevices.js';

const VJSTextTrackDisplay = videojs.getComponent('TextTrackDisplay');

const LINE_STYLE = {
  start: 0,
  center: 50,
  end: 100,
  auto: 100,
};

class TextTrackDisplay extends VJSTextTrackDisplay {
  /**
   *
   * @override
   */
  clearDisplay() {
    if (this.el().firstChild) {
      this.el().removeChild(this.el().firstChild);
    }
  }

  showingTrack() {
    const { tracks_: tracks } = this.player().textTracks();

    return tracks.find(track => track.mode === 'showing');
  }

  /**
   * Sets the text track font size and updates the displayed cue
   * @triggers Events.TEXT_TRACK_SIZE_CHANGE
   * @param {Number} fontPercent the size of the font in percent
   */
  setFontSize(fontPercent) {
    this.fontPercent = fontPercent;
    this.player().trigger({ type: Events.TEXT_TRACK_SIZE_CHANGE, data: fontPercent });
    this.updateDisplay();
  }

  /**
   *
   * @override
   */
  updateDisplay() {
    this.clearDisplay();

    const showingTrack = this.showingTrack();

    if (!showingTrack || !showingTrack.activeCues) {
      return;
    }

    const [cue] = TextTrackDisplay.cues(showingTrack);

    if (cue) {
      this.updateDisplayState(cue);
    }
  }

  /**
   * @param {Object} cue
   * @override
   */
  updateDisplayState(cue) {
    const {
      align, line = LINE_STYLE.end, size, text,
    } = cue;

    const cueWidth = TextTrackDisplay.getWidth(size);
    const cueTop = TextTrackDisplay.getTop(line);

    const [cueEl, cueContainerEl] = this.createStyledElements({
      align, cueTop, cueWidth, text,
    });

    cueContainerEl.appendChild(cueEl);
    this.el().appendChild(cueContainerEl);
  }

  get fontSize() {
    if (this.fontPercent) {
      return this.fontPercent;
    }

    // TODO find a better way to handle fixed font sizes
    return SupportedDevices.isTouchDevice ? 1 : 1.3;
  }

  /**
   * Creates cue styled elements with computed values
   * @param {Object} computedCue
   */
  createStyledElements({
    align, cueTop, cueWidth, text,
  }) {
    const cueEl = TextTrackDisplay.cueEl(text);
    const cueContainerEl = TextTrackDisplay.cueContainerEl(cueEl);

    cueContainerEl.style = `
    text-align: ${align};
    top: ${cueTop};
    transform: translateY(-${cueTop});`;

    cueEl.style = `
    width: ${cueWidth};
    font-size: ${this.fontSize}em;`;

    return [cueEl, cueContainerEl];
  }

  /**
   * Gets the position of the cue in percent
   * When the position is a string, the percent positon is determined with LINE_STYLE
   * When the position is a number, it is considered as the percent position value
   * If the value is incorrect, the default value set is "auto" from LINE_STYLE
   * @param {String|Number} position vertical position of the cue
   */
  static getTop(position) {
    let percentPosition = LINE_STYLE[position] !== undefined ? LINE_STYLE[position] : position;

    if (typeof percentPosition !== 'number' || percentPosition &lt; 0) {
      percentPosition = LINE_STYLE.auto;
    }
    return `${percentPosition}%`;
  }

  static getWidth(size) {
    return size === 100 ? 'auto' : `${size}%`;
  }

  static cueContainerEl() {
    return videojs.dom.createEl('div', {
      className: 'vjs-text-track-display__container',
    });
  }

  static cueEl(text) {
    return videojs.dom.createEl('div', {
      innerHTML: text,
      className: 'vjs-text-track-display__cue',
    });
  }

  static cues(showingTrack) {
    const { cues_: cues = [] } = showingTrack.activeCues;

    return cues;
  }
}

videojs.registerComponent('TextTrackDisplay', TextTrackDisplay);
export default TextTrackDisplay;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="SRGLetterbox.html">SRGLetterbox</a></li><li><a href="SRGLetterbox.MediaComposition.html">MediaComposition</a></li><li><a href="SRGUserStorage.html">SRGUserStorage</a></li></ul><h3>Events</h3><ul><li><a href="global.html#event:ADD_TRACK">ADD_TRACK</a></li><li><a href="global.html#event:ANIMATION_END">ANIMATION_END</a></li><li><a href="global.html#event:BEFOREUNLOAD">BEFOREUNLOAD</a></li><li><a href="global.html#event:CHANGE">CHANGE</a></li><li><a href="global.html#event:CLICK">CLICK</a></li><li><a href="global.html#event:KEY_DOWN">KEY_DOWN</a></li><li><a href="global.html#event:MOUSE_ENTER">MOUSE_ENTER</a></li><li><a href="global.html#event:srgssr/recommendationDisplayed">srgssr/recommendationDisplayed</a></li><li><a href="global.html#event:srgssr/recommendationHit">srgssr/recommendationHit</a></li><li><a href="global.html#event:WEBKIT_CURRENT_PLAYBACK_TARGET_IS_WIRELESS_CHANGED">WEBKIT_CURRENT_PLAYBACK_TARGET_IS_WIRELESS_CHANGED</a></li><li><a href="global.html#event:WEBKIT_PLAYBACK_TARGET_AVAILABILITY_CHANGED">WEBKIT_PLAYBACK_TARGET_AVAILABILITY_CHANGED</a></li><li><a href="SRGLetterbox.html#event:events">events</a></li><li><a href="SRGLetterbox.html#event:playerEvents">playerEvents</a></li><li><a href="SRGLetterbox.html#event:srgEvents">srgEvents</a></li><li><a href="SRGLetterbox.html#event:videojsEvents">videojsEvents</a></li></ul><h3>Global</h3><ul><li><a href="global.html#ABORT">ABORT</a></li><li><a href="global.html#ALMOST_STARTING">ALMOST_STARTING</a></li><li><a href="global.html#containQualities">containQualities</a></li><li><a href="global.html#DISPOSE">DISPOSE</a></li><li><a href="global.html#filterMainResourcesByQuality">filterMainResourcesByQuality</a></li><li><a href="global.html#findChapterByUrn">findChapterByUrn</a></li><li><a href="global.html#findDrmListByResource">findDrmListByResource</a></li><li><a href="global.html#findMainSegment">findMainSegment</a></li><li><a href="global.html#findResourceListByUrn">findResourceListByUrn</a></li><li><a href="global.html#getChapters">getChapters</a></li><li><a href="global.html#getFilteredExternalSubtitles">getFilteredExternalSubtitles</a></li><li><a href="global.html#getMainBlockReason">getMainBlockReason</a></li><li><a href="global.html#getMainChapter">getMainChapter</a></li><li><a href="global.html#getMainChapterImageUrl">getMainChapterImageUrl</a></li><li><a href="global.html#getMainResources">getMainResources</a></li><li><a href="global.html#getMainSegments">getMainSegments</a></li><li><a href="global.html#getMainValidFromDate">getMainValidFromDate</a></li><li><a href="global.html#getMergedAnalyticsData">getMergedAnalyticsData</a></li><li><a href="global.html#getMergedAnalyticsMetadata">getMergedAnalyticsMetadata</a></li><li><a href="global.html#getResourceList">getResourceList</a></li><li><a href="global.html#getSubdivisions">getSubdivisions</a></li><li><a href="global.html#isSourceHD">isSourceHD</a></li><li><a href="global.html#MAX_ITEMS">MAX_ITEMS</a></li><li><a href="global.html#MAX_ROWS">MAX_ROWS</a></li><li><a href="global.html#MIN_HEIGHT">MIN_HEIGHT</a></li><li><a href="global.html#MIN_WIDTH">MIN_WIDTH</a></li><li><a href="global.html#orderMainResourcesByQuality">orderMainResourcesByQuality</a></li><li><a href="global.html#orderMainResourcesByStreamType">orderMainResourcesByStreamType</a></li><li><a href="global.html#PERCENTAGE_MEDIA_CONSUMED">PERCENTAGE_MEDIA_CONSUMED</a></li><li><a href="global.html#PERIOD">PERIOD</a></li><li><a href="global.html#prefix">prefix</a></li><li><a href="global.html#SOON_VALID_PERIOD">SOON_VALID_PERIOD</a></li><li><a href="global.html#TOLERANCE">TOLERANCE</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Fri Feb 12 2021 09:53:42 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
